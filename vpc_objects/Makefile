CC=gcc
# GZ-exp
# CC=gcc44
# basic flags
# _BIN_TRANSLATION_ must be defined
CFLAGS=-O3 -D_BIN_TRANSLATION_ -D__RCDAEMON__
# CFLAGS=-O3 -march=native -D_BIN_TRANSLATION_ -D__RCDAEMON__
# GZ-exp
# CFLAGS=-O3 -D_BIN_TRANSLATION_ -D__RCDAEMON__
# CFLAGS+=-march=core2 -mcx16 -msahf --param l1-cache-size=32 --param l1-cache-line-size=64 --param l2-cache-size=256 -mtune=core2
# CFLAGS=-O3 -D_BIN_TRANSLATION_ -D__RCDAEMON__
# CFLAGS=-Ofast -D_BIN_TRANSLATION_ -D__RCDAEMON__
# stdin format
CFLAGS+=-D_STDIN_FORMAT_C_
# stdout format
CFLAGS+=-D_STDOUT_FORMAT_C_
# CFLAGS+=-D_STDOUT_FORMAT_TIME_STAMP_C_
# perfomrance statistic counters. Affect performance
# CFLAGS+=-D_ENABLE_PERF_COUNTER_
# CFLAGS+=-D_ENABLE_HOME_PERF_COUNTER_
# take effect only when ..._COUNTER_ enabled
# CFLAGS+=-D_ENABLE_PERF_COUNTER_PF_HANDLER_
# enable profiling support
# CFLAGS+=-D_PROFILING_
# debug only. Affect performance. 
# CFLAGS+=-D_DEBUG_LD_REMOTE2_
# CFLAGS+=-DZLOG_FORCE_FLUSH_BUFFER
# debug only. Affect performance.
# CFLAGS+=-D_STDOUT_FORCE_FLUSH_
# shalloc debug flag
# CFLAGS+=-D_DEBUG_MLC_
# CFLAGS+=-D_DEBUG_VIC_
# debug only. Page handler information.
# CFLAGS+=-D_DEBUG_DETERM_SCHED_
# print splitted groups
# CFLAGS+=-D_DEBUG_SPLIT_GROUP_
# CFLAGS+=-D_DEBUG_MERGE_GROUPS_
# CFLAGS+=-D_DEBUG_CS_PRINT_GROUPS_
# CFLAGS+=-D_DEBUG_PAGE_HANDLER_
# CFLAGS+=-D_DEBUG_UDP_
# CFLAGS+=-D_DEBUG_HOME_
# CFLAGS+=-D_DEBUG_PPM_LOG_
# CFLAGS+=-D_DEBUG_VALID_MEM_
# CFLAGS+=-D_MEM_LOG_ACTION_
# CFLAGS+=-D_MEM_LOG_MSG_TIME
# CFLAGS+=-D_MEM_SCHEDULER_LOG_MSG_TIME
# CFLAGS+=-D_DEBUG_PRINT_PT_
# # causion: many logging msgs
# CFLAGS+=-D_MEM_HOME_LOG_MSG_TIME
# CFLAGS+=-D_MEM_UDP_LOG_MSG_TIME
# CFLAGS+=-D_NET_CS_LOG_TIME
# # debug only. Print instructions.
# CFLAGS+=-D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ 
# CFLAGS+=-D_DEBUG_PRINT_NATIVE_INSTR_BINARY_
# CFLAGS+=-D_DEBUG_MOVQ_
# CFLAGS+=-D_DEBUG_SCMP_
# debug only. Waiting list.
# CFLAGS+=-D_DEBUG_WAITING_LIST_
# CFLAGS+=-D_DEBUG_FIND_ADDR_
# IDT
# CFLAGS+=-D_DEBUG_IDT_
# profiling
# CFLAGS+=-D_DEBUG_PROFILLING_
# debug all
# config
# CFLAGS+=-D_DEBUG_CFG_
# CFLAGS+=-D_DEBUG_ -DDEBUG
# CFLAGS+=-g -DZLOG_FORCE_FLUSH_BUFFER -D_DEBUG_ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_MEM_LOG_MSG_TIME -D_DEBUG_PRINT_PT_ -D_DEBUG_PAGE_HANDLER_

# CFLAGS=-O2 -D_BIN_TRANSLATION_ -D__RCDAEMON__ -D_STDOUT_FORMAT_C_ -D_STDIN_FORMAT_C_

# CFLAGS+=-g -DZLOG_FORCE_FLUSH_BUFFER -D_DEBUG_ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_MEM_LOG_MSG_TIME -D_DEBUG_PRINT_PT_ -D_DEBUG_PAGE_HANDLER_
# CFLAGS=-O2 -D_BIN_TRANSLATION_ -D__RCDAEMON__ -D_STDOUT_FORMAT_TIME_STAMP_C_ -D_STDIN_FORMAT_C_
# CFLAGS=-O2 -D_BIN_TRANSLATION_ -D__RCDAEMON__ -D_STDOUT_FORMAT_C_ -D_STDIN_FORMAT_C_ -D_STDOUT_FORCE_FLUSH_
# CFLAGS=-O2 -D_BIN_TRANSLATION_ -D__RCDAEMON__ -D_STDOUT_FORMAT_C_ -D_STDIN_FORMAT_C_ -D_DEBUG_
# -D_MEM_LOG_ACTION_ -D_MORE_LOG_PERF_COUNTER_
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -D_STDOUT_FORMAT_C_ -D_MORE_LOG_PERF_COUNTER_
# -D_MEM_LOG_MSG_TIME
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -D_STDOUT_FORMAT_C_ 
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -D_STDOUT_FORMAT_C_ -DZLOG_FORCE_FLUSH_BUFFER
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -D_STDOUT_FORMAT_C_ -DZLOG_FORCE_FLUSH_BUFFER -D_MEM_LOG_MSG_TIME
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -D_STDOUT_FORMAT_LD_LX_C_
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -DZLOG_FORCE_FLUSH_BUFFER
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -DZLOG_FORCE_FLUSH_BUFFER -g
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -DZLOG_FORCE_FLUSH_BUFFER -g -D__DEBUG__ -D_DEBUG_
# CFLAGS=-D_BIN_TRANSLATION_ -DZLOG_FORCE_FLUSH_BUFFER -g -D__DEBUG__ -D_DEBUG_
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_
# CFLAGS=-D_BIN_TRANSLATION_ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ 
# CFLAGS=-D_BIN_TRANSLATION_ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_  -D__ASK_PRINT_MEM__
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_STDOUT_FORMAT_TIME_STAMP_LD_LX_C_
# flags for detailed debugging 
#  stdout print char only
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_STDOUT_FORMAT_C_
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_STDOUT_FORMAT_C_ -D_MEM_LOG_MSG_TIME
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_STDOUT_FORMAT_C_ -D_MEM_LOG_MSG_TIME
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_STDOUT_FORMAT_C_ -D_MEM_LOG_MSG_TIME -D_DEBUG_PRINT_PT_ -D_DEBUG_PAGE_HANDLER_
#  stdout print more formats
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_STDOUT_FORMAT_LD_LX_C_
# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_STDOUT_FORMAT_LD_LX_C_ -D_ -D_DEBUG_PRINT_INSTR_FIND_ADDR_
# flags for interactive debugging
# CFLAGS=-D_BIN_TRANSLATION_ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_STDOUT_FORMAT_C_ -D__ASK_PRINT_MEM__

# CFLAGS=-D_BIN_TRANSLATION_ -D__RCDAEMON__ -g -DZLOG_FORCE_FLUSH_BUFFER -D__DEBUG__ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_STDOUT_FORMAT_LD_LX_C_ -D_MEM_LOG_MSG_TIME -D_DEBUG_PRINT_PT_ -D_DEBUG_PAGE_HANDLER_

# CFLAGS=-O2 -D_BIN_TRANSLATION_ -D__RCDAEMON__ -D_STDOUT_FORMAT_C_ -D_STDIN_FORMAT_C_
# CFLAGS+=-g -DZLOG_FORCE_FLUSH_BUFFER -D_DEBUG_ -D_DEBUG_COMMIT_ -D__DEBUG__ -D_DEBUG_ -D_DEBUG_UDP_ -D_DEBUG_PAGE_HANDLER_ -D_DEBUG_PRINT_NATIVE_INSTR_ -D_DEBUG_PRINT_INSTR_ -D_MEM_LOG_MSG_TIME -D_DEBUG_PRINT_PT_ -D_DEBUG_PAGE_HANDLER_

# -Wall 
# -D_MEM_COMM_STATUS_
#  dynamically linked library
# LDFLAGS=-lpthread
#
#  statically linked
LDFLAGS=-static -pthread

all: vpc scheduler mem_home 

vpc_obj=zlog.o net_cs.o mem.o misc.o parameter.o mem.vpc.o rcb.o schedulerlib.o perf_counter.o vpc_perf_counter.o bin_translator.o vic.o vpc.o

vpc: $(vpc_obj)
	$(CC) $(CFLAGS) $(LDFLAGS) $(vpc_obj) runner_wrapper_bin_tran.s -o vpc

scheduler_obj=zlog.o net_cs.o mem.o mem.scheduler.o misc.o parameter.o rcb.o schedulerlib.o schedulerlib.mem.o scheduler.o

scheduler: $(scheduler_obj)
	$(CC) $(CFLAGS) $(LDFLAGS) $(scheduler_obj) -o scheduler

mem_home_obj=parameter.o misc.o mem.o net_cs.o zlog.o perf_counter.o mem_home_perf_counter.o ght/hash_functions.o ght/hash_table.o mem.home.o

mem_home: $(mem_home_obj)
	$(CC) $(CFLAGS) $(LDFLAGS) $(mem_home_obj) -o mem_home

clean:
	rm -f vpc vpc translator $(vpc_obj) $(scheduler_obj) $(mem_home_obj)  mem.scheduler.o mem_home scheduler

